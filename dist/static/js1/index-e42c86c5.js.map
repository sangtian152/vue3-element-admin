{"version":3,"file":"index-e42c86c5.js","sources":["../../../src/views/login/index.vue"],"sourcesContent":["<template>\r\n\t<div class=\"login-container\">\r\n    <div class=\"login-main\">\r\n      <h3 class=\"title\">用户登录</h3>\r\n      <el-form ref=\"loginFormRef\" :model=\"loginForm\" :rules=\"loginRules\">\r\n        <el-form-item prop=\"username\">\r\n          <el-input v-model=\"loginForm.username\"></el-input>\r\n        </el-form-item>\r\n        <el-form-item prop=\"password\">\r\n          <el-input type=\"password\" v-model=\"loginForm.password\"></el-input>\r\n        </el-form-item>\r\n        <el-form-item>\r\n          <el-button\r\n            :loading=\"loading\"\r\n            type=\"primary\"\r\n            style=\"width:100%;\"\r\n            @click=\"handleLogin(loginFormRef)\"\r\n          >\r\n            登录\r\n          </el-button>\r\n        </el-form-item>\r\n      </el-form>\r\n      <p class=\"footer\">\r\n        <span>用户名：admin</span>\r\n        <span>密码：123456</span>\r\n      </p>\r\n    </div>\r\n\t</div>\r\n</template>\r\n<script setup lang=\"ts\">\r\n\timport { ref, reactive } from 'vue'\r\n\timport { validUsername } from '@/utils/validate'\r\n\timport { useUserStore } from '@/stores/user'\r\n  import type { FormInstance, FormRules } from 'element-plus'\r\n\timport { useRouter, useRoute } from 'vue-router'\r\n  const route = useRoute()\r\n  const router = useRouter()\r\n  const loginFormRef = ref<FormInstance>()\r\n  const loginForm = reactive({\r\n\t\t\tusername: \"admin\",\r\n\t\t\tpassword: \"123456\"\r\n\t\t})\r\n  const loading = ref(false)\r\n  const userStore = useUserStore()\r\n  const getOtherQuery = (query: Record<string, string | string[]>) => {\r\n    return Object.keys(query).reduce((acc, cur) => {\r\n    if (cur !== 'redirect') {\r\n      acc[cur] = query[cur]\r\n    }\r\n    return acc\r\n    }, {} as Record<string, string | string[]>)\r\n  }\r\n  const validateUsername = (rule: any, value: string, callback: Function) => {\r\n    if (!validUsername(value)) {\r\n    callback(new Error('请输入正确的用户名'))\r\n    } else {\r\n    callback()\r\n    }\r\n  }\r\n\r\n  const validatePassword = (rule: any, value: string, callback: Function) => {\r\n    if (value.length < 6) {\r\n    callback(new Error('密码不小于6位'))\r\n    } else {\r\n    callback()\r\n    }\r\n  }\r\n  const loginRules = reactive<FormRules>({\r\n    username: [{ validator: validateUsername, trigger: 'blur' }],\r\n    password: [{ validator: validatePassword, trigger: 'blur' }]\r\n  })\r\n  let otherQuery = {}\r\n  const\thandleLogin = (loginFormRef: FormInstance | undefined) => {\r\n    if (!loginFormRef) return\r\n    let redirect = route.query.redirect as string\r\n    loginFormRef.validate(async(valid: boolean) => {\r\n      if (valid) {\r\n        loading.value = true\r\n        await userStore.login(loginForm)\r\n        router.push({\r\n          path: redirect || '/',\r\n              query: otherQuery\r\n        })\r\n        // Just to simulate the time of the request\r\n        setTimeout(() => {\r\n          loading.value = false\r\n        }, 0.5 * 1000)\r\n      } else {\r\n        return false\r\n      }\r\n    })\r\n  }\r\n</script>\r\n<style lang=\"scss\" scoped>\r\n  .login-container {\r\n    display: flex;\r\n    height: 100%;\r\n    align-items: center;\r\n    background-image: url('@/assets/bg.jpg');\r\n    background-color: #2d3a4b;\r\n    .login-main {\r\n      width: 320px;\r\n      margin: 0 auto;\r\n      padding: 30px;\r\n      background: #fff;\r\n      .title {\r\n        text-align: center;\r\n        margin-bottom: 20px;\r\n      }\r\n      .footer {\r\n        display: flex;\r\n        font-size: 13px;\r\n        justify-content: space-between;\r\n      }\r\n    }\r\n  }\r\n</style>"],"names":["route","useRoute","router","useRouter","loginFormRef","ref","loginForm","reactive","loading","userStore","useUserStore","loginRules","rule","value","callback","validUsername","otherQuery","handleLogin","redirect","valid"],"mappings":"+eAmCE,MAAMA,EAAQC,IACRC,EAASC,IACTC,EAAeC,IACfC,EAAYC,EAAS,CAC1B,SAAU,QACV,SAAU,QAAA,CACV,EACKC,EAAUH,EAAI,EAAK,EACnBI,EAAYC,IAwBZC,EAAaJ,EAAoB,CACrC,SAAU,CAAC,CAAE,UAhBU,CAACK,EAAWC,EAAeC,IAAuB,CACpEC,EAAcF,CAAK,EAGfC,IAFAA,EAAA,IAAI,MAAM,wDAAW,CAAC,CAG/B,EAW0C,QAAS,OAAQ,EAC3D,SAAU,CAAC,CAAE,UATU,CAACF,EAAWC,EAAeC,IAAuB,CACrED,EAAM,OAAS,EACVC,EAAA,IAAI,MAAM,uCAAS,CAAC,EAEpBA,GACT,EAI0C,QAAS,OAAQ,CAAA,CAC5D,EACD,IAAIE,EAAa,CAAA,EACX,MAAAC,EAAeb,GAA2C,CAC9D,GAAI,CAACA,EAAc,OACf,IAAAc,EAAWlB,EAAM,MAAM,SAC3BI,EAAa,SAAS,MAAMe,GAAmB,CAC7C,GAAIA,EACFX,EAAQ,MAAQ,GACV,MAAAC,EAAU,MAAMH,CAAS,EAC/BJ,EAAO,KAAK,CACV,KAAMgB,GAAY,IACd,MAAOF,CAAA,CACZ,EAED,WAAW,IAAM,CACfR,EAAQ,MAAQ,EAAA,EACf,GAAM,GAAI,MAEN,OAAA,EACT,CACD,CAAA"}