import{s as et,d as se,r as $,a as fe,q as ae,b as P,o as L,t as re,w as j,e as R,f as X,g as Te,n as qe,c as K,x as $e,y as ee,z as me,A as le,B as Le,C as ve,D as Ne,E as we,T as Ke,G as tt,H as ot,I as H,j as _e,J as nt,K as We,L as Ie,M as be,N as at,F as Xe,O as lt,P as Ye,Q as rt}from"./index.ac968d75.js";import{r as dt}from"./index.739d92e5.js";const st=e=>et({url:"/mock/tree.json",method:"post",data:e}),ut={class:"dialog-footer"},ct=Te("\u53D6\u6D88"),it=Te("\u786E\u5B9A"),pt=se({__name:"addTreeNode",props:{visible:Boolean},emits:["submit","close","update:visible"],setup(e,{emit:t}){const o=e,a=$(),c=$(!1),i=fe({label:""}),r=fe({label:[{required:!0,message:"\u8BF7\u8F93\u5165\u8282\u70B9\u540D\u79F0",trigger:"blur"}]});console.log(o),ae(()=>o.visible,s=>{console.log(o.visible,46),c.value=s});const g=async s=>{!s||await s.validate((n,u)=>{n?(t("submit",i),v()):console.log("error submit!",u)})},p=s=>{!s||s.resetFields(["label"])},v=()=>{p(qe(a)),t("close"),t("update:visible",!1),c.value=!1};return(s,n)=>{const u=P("el-input"),h=P("el-form-item"),D=P("el-form"),y=P("el-button"),_=P("el-dialog");return L(),re(_,{modelValue:c.value,"onUpdate:modelValue":n[2]||(n[2]=b=>c.value=b),title:"\u6DFB\u52A0\u7EC4\u7EC7",width:"30%","before-close":v},{footer:j(()=>[R("span",ut,[X(y,{onClick:v},{default:j(()=>[ct]),_:1}),X(y,{type:"primary",onClick:n[1]||(n[1]=b=>g(a.value))},{default:j(()=>[it]),_:1})])]),default:j(()=>[X(D,{ref_key:"formRef",ref:a,"label-width":"100px",model:i,rules:r},{default:j(()=>[X(h,{label:"\u8282\u70B9\u540D\u79F0",prop:"label"},{default:j(()=>[X(u,{modelValue:i.label,"onUpdate:modelValue":n[0]||(n[0]=b=>i.label=b)},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue"])}}}),z=function(e){return Object.prototype.toString.call(e)==="[object Object]"},Z=function(e){return typeof e=="string"},te=function(e){return typeof e=="number"},J={print:(e,t,o)=>Z(t)||typeof o=="boolean",pretty:(e,t,o)=>Z(t)&&Z(e)||typeof o=="string",primary:(e,t)=>Z(e)||typeof t=="boolean",success:(e,t)=>Z(e)||typeof t=="boolean",info:(e,t)=>Z(e)||typeof t=="boolean",warning:(e,t)=>Z(e)||typeof t=="boolean",danger:(e,t)=>Z(e)||typeof t=="boolean"};function ue(e="default"){let t="";switch(e){case"primary":t="#2d8cf0";break;case"success":t="#19be6b";break;case"info":t="#909399";break;case"warning":t="#ff9900";break;case"danger":t="#ff4d4f";break;case"default":t="#35495E";break;default:t=e}return t}J.print=function(e,t="default",o=!1){return typeof e=="object"?(console.dir(e),!0):(o?console.log(`%c ${e} `,`background:${ue(t)}; padding: 2px; border-radius: 4px;color: #fff;`):console.log(`%c ${e} `,`color: ${ue(t)};`),!0)},J.pretty=function(e,t,o="primary"){return console.log(`%c ${e} %c ${t} %c`,`background:${ue(o)};border:1px solid ${ue(o)}; padding: 1px; border-radius: 4px 0 0 4px; color: #fff;`,`border:1px solid ${ue(o)}; padding: 1px; border-radius: 0 4px 4px 0; color: ${ue(o)};`,"background:transparent"),!0},J.primary=function(e,t=!1){return this.print&&this.print(e,"primary",t),!0},J.success=function(e,t=!1){return this.print&&this.print(e,"success",t),!0},J.info=function(e,t=!1){return this.print&&this.print(e,"info",t),!0},J.warning=function(e,t=!1){return this.print&&this.print(e,"warning",t),!0},J.danger=function(e,t=!1){return this.print&&this.print(e,"danger",t),!0};const pe=function(){let e=!1;return{get:()=>e,set:t=>{e=t}}}(),Je=function(e,t,o){const{id:a,children:c}=t;if(e[a]===o)return e;if(Array.isArray(e[c])){const i=e[c];for(let r=0,g=i.length;r<g;r++){const p=i[r],v=Je(p,t,o);if(v)return v}}},ft=function(e,t){const{parenNode:o,onlyOneNode:a,cloneNodeDrag:c}=t;if(o.value){const{keys:i}=t,{id:r,pid:g}=i,p=o.value.$$data,v=JSON.parse(JSON.stringify(e.$$data));if(c){(function(n,u,h){const{children:D}=u;if(z(n))y(n);else if(Array.isArray(n))for(let _=0,b=n.length;_<b;_++)y(n[_]);function y(_){if(h(_),Array.isArray(_[D])){const b=_[D];for(let E=0,N=b.length;E<N;E++)y(b[E])}}})(v,i,function(n){typeof n[r]=="string"&&n[r].indexOf("clone-node")!==-1&&(n[r]=`clone-node-${n[r]}`)});const{children:s}=i;a&&Array.isArray(v[s])&&(v[s]=[]),v[i.pid]=p[i.id],p.children?p.children.push(v):p.children=[v]}else(function(s,n){const{keys:u,data:h,onlyOneNode:D}=n,{id:y,pid:_,children:b}=u,E=Je(h,u,s[_]),N=E[b];let C;for(let x=0,w=N.length;x<w;x++)if(N[x][y]===s[y]){N.splice(x,1),C=x;break}const f=s[b];D&&C!==void 0&&f&&(s[b]=[],f.forEach(x=>{x[_]=E[y]}),E[b].splice(C,0,...f))})(v,t),v[g]=p[r],p.children?p.children.push(v):p.children=[].concat(v)}},He={beforeMount(e,t){const{l:o,t:a}=t.modifiers,{drag:c,dragData:i,node:r,emit:g,beforeDragEnd:p,initNodes:v}=t.value,{value:s}=t,n={...i};e.addEventListener("mousedown",function(f){const x=f.target;if(c===!1||f.button!==0||r.focused||r.$$data.noDragging||x.className.indexOf("tree-org-node-btn")>-1)return!1;(function(w){w.stopPropagation(),y=w.screenX,_=w.screenY,h=0,n.contextmenu.value=!1;const{keys:G,onlyOneNode:Q}=n;if(Q){const{children:W}=G,Y={...r.$$data};Y[W]=[],n.cloneData.value=v(Y)}else n.cloneData.value=v(r.$$data)})(f),document.addEventListener("mousemove",b),document.addEventListener("mouseup",E),C("start")});let u,h=0,D=!1,y=0,_=0;function b(f){return f.preventDefault(),!(Math.abs(f.screenX-y)<5&&Math.abs(f.screenY-_)<5)&&(D||(D=!0,function(x){pe.set(!0),n.nodeMoving.value=!0,r.moving=!0;let w=e;for(;!w.classList.contains("tree-org-node");)h+=w.offsetLeft,w=w.offsetParent;h+=2,u=document.querySelector("#clone-tree-org"),u&&(u.style.width=`${w.clientWidth}px`,u.style.opacity="0.8",u.style.left=x.clientX-h+"px",u.style.top=x.clientY+2+"px")}(f)),o&&a&&s?(u&&(u.style.left=f.clientX-h+"px",u.style.top=f.clientY+2+"px"),void C("move")):o&&s?(e.style.left=f.clientX-h+"px",void C("move")):void(a&&s&&(e.style.top=f.clientY+"px",C("move"))))}function E(f){if(document.removeEventListener("mousemove",b),document.removeEventListener("mouseup",E),D){if(typeof p=="function"){const x=p(r,n.parenNode.value);x&&x.then?x.then(()=>{N(f)},()=>{}):x!==!1&&N(f)}else N(f);D=!1,u=null,r.moving=!1,n.nodeMoving.value=!1,setTimeout(()=>{pe.set(!1)},200)}}function N(f){const x=document.querySelector(".tree-org-node__moving");if(x&&x.contains(f.target))return C("end"),!1;ft(r,n),C("end")}function C(f){f!=="start"?f!=="move"?f==="end"&&g("on-node-drag-end",r,n.parenNode.value):g("on-node-drag",r):g("on-node-drag-start",r)}}},ze={onClick:"onNodeClick",onDblclick:"onNodeDblclick",onContextmenu:"onNodeContextmenu",onMouseenter:"onNodeMouseenter",onMouseleave:"onNodeMouseleave"};function mt(e,t){if(typeof e=="function")return function(o){o.target.className.indexOf("org-tree-node-btn")>-1||e(o,t)}}const Ge=(e,t,o)=>!(Array.isArray(e[t])&&e[t].length>0)&&!o||e.isLeaf,Qe=(e,t,o)=>{const{attrs:a}=o,c=["tree-org-node"],i=[],{expand:r,children:g,id:p}=t;return Ge(t,"children",a.lazy)?c.push("is-leaf"):a.collapsable&&!r&&c.push("collapsed"),t.moving&&c.push("tree-org-node__moving"),i.push(vt(e,t,o)),a.collapsable&&!r||i.push(gt(e,g,o)),ve(e("div",{class:c,key:p},i),[[Ne,!t.hidden]])},vt=(e,t,o)=>{const{attrs:a}=o,c=a.props,i=a.renderContent,{label:r}=t,g=[];if(o.slots.default)g.push(o.slots.default({node:t}));else if(typeof i=="function"){J.warning("scoped-slot header is easier to use. We recommend users to use scoped-slot header.");const f=i(e,t);f&&g.push(f)}else g.push(e("div",{class:"tree-org-node__text"},r));a.collapsable&&!Ge(t,"children",a.lazy)&&g.push(((f,x,w)=>{const{attrs:G}=w,Q=G.onOnExpand,W=["tree-org-node__expand"];x.expand&&W.push("expanded");const Y=[];return w.slots.expand?Y.push(w.slots.expand({node:x})):Y.push(f("span",{class:"tree-org-node__expand-btn"})),f("span",{class:W,onMousedown:U=>{U.stopPropagation()},onDblclick:U=>{U.stopPropagation()},onClick:U=>{U.stopPropagation(),Q&&Q(U,x)}},Y)})(e,t,o));const p=["tree-org-node__inner"];let{labelStyle:v,labelClassName:s,selectedClassName:n,selectedKey:u}=a;typeof s=="function"&&(s=s(t)),s&&p.push(s),t.className&&p.push(t.className),typeof n=="function"&&(n=n(t)),u!==void 0&&(u=Array.isArray(u)?u:[u]),n&&u&&u.includes(t.id)&&p.push(n);const h=["tree-org-node__content"];t.$$root&&h.push(`is-root_${a.suffix}`),t.label||h.push("is-empty"),t.$$focused&&h.push("is-edit");const D=Ye("nodedrag"),y=[];a.vNodedrag&&D&&!t.$$root&&y.push([D,Object.assign({node:t},a.vNodedrag),"",{l:!0,t:!0}]);const _={};for(const f in ze)if(Object.prototype.hasOwnProperty.call(ze,f)){const x=a[ze[f]];x&&(_[f]=mt(x,t))}const b=a.onNodeFocus,E=a.onNodeBlur,N=Ye("focus"),C=[[Ne,t.$$focused]];return N&&C.push([N,t.$$focused]),e("div",{class:h},[ve(e("div",{class:p,style:t.style?t.style:v,..._},g),y),ve(e("textarea",{class:"tree-org-node__textarea",placeholder:"\u8BF7\u8F93\u5165\u8282\u70B9\u540D\u79F0",value:t.label,onFocus:f=>{b&&b(f,t.$$data,t)},onInput:f=>{t.label=f.target.value},onBlur:f=>{t.$$data.focused!==void 0&&(t.$$data.focused=!1),t.$$data[c.label]=f.target.value,t.$$focused=!1,E&&E(f,t.$$data,t)},onClick:f=>f.stopPropagation()}),C)])},gt=(e,t,o)=>{if(Array.isArray(t)&&t.length){const a=t.filter(c=>!c.$$hidden).map(c=>Qe(e,c,o));return e("div",{class:"tree-org-node__children"},a)}return""},je=(e,t)=>e.data?(e.data.$$root=!e.isClone,Qe(ot,e.data,t)):"";je.directives={focus:{mounted(e,{value:t}){t&&e.focus()},updated(e,{value:t}){t&&e.focus()}},nodedrag:He};var Oe=se({props:{scale:String,tools:Object},setup(e,{emit:t}){const o=$(!1),a=$(!1);function c(p){a.value=!a.value,t("onFullscreen",p)}function i(){document.isFullScreen||document.mozIsFullScreen||document.webkitIsFullScreen||!a.value||c("esc")}const r=H(()=>o.value?"\u5168\u90E8\u6536\u8D77":"\u5168\u90E8\u5C55\u5F00"),g=H(()=>a.value?"\u9000\u51FA\u5168\u5C4F":"\u5168\u5C4F");return _e(()=>{window.addEventListener("resize",i)}),nt(()=>{window.removeEventListener("resize",i)}),{expanded:o,fullscreen:a,expandTitle:r,fullTiltle:g,handleExpand:function(){o.value=!o.value,t("onExpand")},handleScale:function(p){p==="out"?t("onScale",.1):p==="in"?t("onScale",-.1):t("onRestore")},handleFullscreen:c}}});const ht={class:"zm-tree-handle"},yt={key:0,class:"zm-tree-percent"},bt=["title"],xt={class:"zm-tree-svg"},$t=[R("span",{class:"zm-tree-icon"},"+",-1)],Nt=[R("span",{class:"zm-tree-icon"},"-",-1)],_t=[R("span",{class:"zm-tree-restore"},null,-1)],St=["title"],Dt={class:"zm-tree-svg"};function Ue(e){return typeof e=="function"||Object.prototype.toString.call(e)==="[object Function]"}function Me(e,t,o,a=1){return{deltaX:Math.round(t/a/e[0])*e[0],deltaY:Math.round(o/a/e[1])*e[1]}}function ce(e,t,o){return e<t?t:o<e?o:e}Oe.render=function(e,t,o,a,c,i){return L(),K("div",ht,[e.tools.scale?(L(),K("div",yt,$e(e.scale),1)):ee("v-if",!0),e.tools.expand?(L(),K("div",{key:1,onClick:t[0]||(t[0]=(...r)=>e.handleExpand&&e.handleExpand(...r)),title:e.expandTitle,class:"zm-tree-handle-item"},[R("span",xt,[R("i",{class:me(["treefont",e.expanded?"icon-collapse":"icon-expand"])},null,2)])],8,bt)):ee("v-if",!0),e.tools.zoom?(L(),K("div",{key:2,onClick:t[1]||(t[1]=r=>e.handleScale("out")),title:"\u653E\u5927",class:"zm-tree-handle-item zoom-out"},$t)):ee("v-if",!0),e.tools.zoom?(L(),K("div",{key:3,onClick:t[2]||(t[2]=r=>e.handleScale("in")),title:"\u7F29\u5C0F",class:"zm-tree-handle-item zoom-in"},Nt)):ee("v-if",!0),e.tools.restore?(L(),K("div",{key:4,onClick:t[3]||(t[3]=r=>e.handleScale("restore")),title:"\u8FD8\u539F",class:"zm-tree-handle-item"},_t)):ee("v-if",!0),e.tools.fullscreen?(L(),K("div",{key:5,onClick:t[4]||(t[4]=(...r)=>e.handleFullscreen&&e.handleFullscreen(...r)),title:e.fullTiltle,class:"zm-tree-handle-item"},[R("span",Dt,[R("i",{class:me(["treefont",e.fullscreen?"icon-unfullscreen":"icon-fullscreen"])},null,2)])],8,St)):ee("v-if",!0)])},Oe.__file="src/components/tools/tools.vue";const ye=function(e,t,o,a=!1){e&&t&&o&&e.addEventListener(t,o,a)},ne=function(e,t,o,a=!1){e&&t&&o&&e.removeEventListener(t,o,a)},Ct=(e,{emit:t},o)=>{const a={start:"mousedown",move:"mousemove",stop:"mouseup"},c={start:"touchstart",move:"touchmove",stop:"touchend"},i={userSelect:"none",MozUserSelect:"none",WebkitUserSelect:"none",MsUserSelect:"none"},r={userSelect:"auto",MozUserSelect:"auto",WebkitUserSelect:"auto",MsUserSelect:"auto"};let g=a;const p=$(e.x),v=$(e.y),s=$(e.z),n=$(e.active),u=$(!1),h=$(0),D=$(0),y=$(0),_=$(0),b=$(0),E=$(0);let N={},C={};function f(){N={mouseX:0,mouseY:0,x:0,y:0,w:0,h:0},C={minLeft:-1/0,maxLeft:1/0,minRight:-1/0,maxRight:1/0,minTop:-1/0,maxTop:1/0,minBottom:-1/0,maxBottom:1/0}}function x(){if(e.parent){const[m,F]=w();b.value=m||0,E.value=F||0}}function w(){if(e.parent&&o.eleRef.value){const m=window.getComputedStyle(o.eleRef.value.parentNode,null);return[parseInt(m.getPropertyValue("width"),10),parseInt(m.getPropertyValue("height"),10)]}return[0,0]}function G(m){if(m instanceof MouseEvent&&m.which!==1)return;const F=m.target||m.srcElement;if(F&&o.eleRef.value&&o.eleRef.value.contains(F)){if(e.dragCancel&&function(M,V,q){let A=M;const oe=["matches","webkitMatchesSelector","mozMatchesSelector","msMatchesSelector","oMatchesSelector"].find(d=>A&&Ue(A[d]))||"";if(!Ue(A[oe]))return!1;do{if(A[oe](V))return!0;if(A===q)return!1;A=A.parentNode}while(A);return!1}(F,e.dragCancel,o.eleRef.value))return void(u.value=!1);n.value||(n.value=!0,t("activated"),t("update:active",!0)),e.draggable&&(u.value=!0),m instanceof MouseEvent?(N.mouseX=m.pageX,N.mouseY=m.pageY):(N.mouseX=m.touches[0].pageX,N.mouseY=m.touches[0].pageY),N.left=p.value,N.right=h.value,N.top=v.value,N.bottom=D.value,e.parent&&(C=Q()),ye(document.documentElement,g.move,Y),ye(document.documentElement,g.stop,U)}}function Q(){const m=e.grid;return{minLeft:p.value%m[0],maxLeft:Math.floor((b.value-y.value-p.value)/m[0])*m[0]+p.value,minRight:h.value%m[0],maxRight:Math.floor((b.value-y.value-h.value)/m[0])*m[0]+h.value,minTop:v.value%m[1],maxTop:Math.floor((E.value-_.value-v.value)/m[1])*m[1]+v.value,minBottom:D.value%m[1],maxBottom:Math.floor((E.value-_.value-D.value)/m[1])*m[1]+D.value}}function W(m){const F=m.target||m.srcElement;o.eleRef.value&&!o.eleRef.value.contains(F)&&n.value&&!e.preventDeactivation&&(n.value=!1,t("deactivated"),t("update:active",!1))}function Y(m){u.value&&function(F){const M=e.axis,V=e.grid;let q=0,A=0;F instanceof MouseEvent?(q=F.pageX,A=F.pageY):(q=F.touches[0].pageX,A=F.touches[0].pageY);const oe=M&&M!=="y"?N.mouseX-q:0,d=M&&M!=="x"?N.mouseY-A:0,{deltaX:l,deltaY:S}=Me(V,oe,d,e.scale),k=ce(N.left-l,C.minLeft,C.maxLeft),O=ce(N.top-S,C.minTop,C.maxTop),B=ce(N.right+l,C.minRight,C.maxRight),T=ce(N.bottom+S,C.minBottom,C.maxBottom);p.value=k,v.value=O,h.value=B,D.value=T,t("dragging",p.value,v.value)}(m)}function U(){f(),u.value&&(u.value=!1,t("dragstop",p.value,v.value))}We(()=>{f()}),_e(()=>{!e.enableNativeDrag&&o.eleRef.value&&(o.eleRef.value.ondragstart=()=>!1);const[m,F]=w();if(b.value=m,E.value=F,o.eleRef.value){const[M,V]=function(q){const A=window.getComputedStyle(q);return[parseFloat(A.getPropertyValue("width")),parseFloat(A.getPropertyValue("height"))]}(o.eleRef.value);y.value=M,_.value=V,h.value=b.value-y.value-p.value,D.value=E.value-_.value-v.value}ye(document.documentElement,"mousedown",W),ye(document.documentElement,"touchend touchcancel",W),ye(window,"resize",x)}),Ie(()=>{ne(document.documentElement,"mousedown",W),ne(document.documentElement,"touchstart",U),ne(document.documentElement,"mousemove",Y),ne(document.documentElement,"touchmove",Y),ne(document.documentElement,"mouseup",U),ne(document.documentElement,"touchend touchcancel",W),ne(window,"resize",x)});const De=H(()=>({transform:`translate(${p.value}px, ${v.value}px)`,zIndex:s.value,...u.value&&e.disableUserSelect?i:r}));return ae(()=>e.active,m=>{n.value=m,t(m?"activated":"deactivated")}),ae(()=>e.z,m=>{(m>=0||m==="auto")&&(s.value=m)}),ae(()=>e.x,m=>{u.value||(e.parent&&(C=Q()),function(F){const{deltaX:M}=Me(e.grid,F,v.value,e.scale),V=ce(M,C.minLeft,C.maxLeft);p.value=V,h.value=b.value-y.value-V}(m))}),ae(()=>e.y,m=>{u.value||(e.parent&&(C=Q()),function(F){const{deltaY:M}=Me(e.grid,p.value,F,e.scale),V=ce(M,C.minTop,C.maxTop);v.value=V,D.value=E.value-_.value-V}(m))}),{enabled:n,dragging:u,style:De,resetBoundsAndMouseState:f,elementTouchDown:function(m){g=c,G(m)},elementMouseDown:function(m){g=a,G(m)}}},Fe=Symbol("wrapper");function kt(e,t){if((o=e)===null||typeof o!="object"||e.__elPropsReservedKey)return e;var o;const{values:a,required:c,default:i,type:r,validator:g}=e,p=a||g?v=>{let s=!1,n=[];if(a&&(n=[...a,i],s=s||n.includes(v)),g&&(s=s||g(v)),!s&&n.length>0){const u=[...new Set(n)].map(h=>JSON.stringify(h)).join(", ");rt(`Invalid prop: validation failed${t?` for prop "${t}"`:""}. Expected one of [${u}], got value ${JSON.stringify(v)}.`)}return s}:void 0;return{type:typeof r=="object"&&Object.getOwnPropertySymbols(r).includes(Fe)?r[Fe]:r,validator:p,__elPropsReservedKey:!0,default:i,required:!!c}}const Se=e=>function(t){let o=-1;const a=t?t.length:0,c={};for(;++o<a;){const i=t[o];c[i[0]]=i[1]}return c}(Object.entries(e).map(([t,o])=>[t,kt(o,t)])),de=e=>({[Fe]:e});var Be=se({replace:!0,name:"Draggable",props:Se({className:{type:String,default:"zm-draggable"},classNameDraggable:{type:String,default:"draggable"},classNameDragging:{type:String,default:"dragging"},classNameActive:{type:String,default:"active"},disableUserSelect:{type:Boolean,default:!0},enableNativeDrag:{type:Boolean,default:!1},preventDeactivation:{type:Boolean,default:!1},active:{type:Boolean,default:!1},draggable:{type:Boolean,default:!0},x:{type:Number,default:0},y:{type:Number,default:0},z:{type:[String,Number],default:"auto",validator:e=>typeof e=="string"?e==="auto":e>=0},dragCancel:String,axis:{type:String,default:"both",validator:e=>["x","y","both"].includes(e)},grid:{type:Array,default:()=>[1,1]},parent:{type:Boolean,default:!1},scale:{type:Number,default:1,validator:e=>e>0}}),emits:{activated:()=>!0,deactivated:()=>!0,dragging:(e,t)=>te(e)&&te(t),dragstop:(e,t)=>te(e)&&te(t),"update:active":e=>typeof e=="boolean"},setup(e,t){const o=$(),a=Ct(e,t,{eleRef:o});return{top,eleRef:o,...a}}});Be.render=function(e,t,o,a,c,i){return L(),K("div",{style:Le(e.style),class:me([{[e.classNameActive]:e.enabled,[e.classNameDragging]:e.dragging,[e.classNameDraggable]:e.draggable},e.className]),ref:"eleRef",onMousedown:t[0]||(t[0]=(...r)=>e.elementMouseDown&&e.elementMouseDown(...r)),onTouchstart:t[1]||(t[1]=(...r)=>e.elementTouchDown&&e.elementTouchDown(...r))},[le(e.$slots,"default")],38)},Be.__file="src/components/draggable/src/draggable.vue";var Re=se({components:{TreeOrgNode:je},props:Se({data:{type:Object,required:!0},props:{type:de(Object)},modelValue:Boolean,horizontal:Boolean,selectedKey:String,collapsable:Boolean,renderContent:Function,labelStyle:Object,labelClassName:{type:[Function,String]}}),setup:(e,t)=>({defaultSlot:!!t.slots.default,expandSlot:!!t.slots.expand})});Re.render=function(e,t,o,a,c,i){const r=P("tree-org-node");return L(),re(Ke,{to:"body"},[ve(R("div",{id:"clone-tree-org",class:me(["clone-tree-org tree-org",{horizontal:e.horizontal,collapsable:e.collapsable}])},[X(r,{data:e.data,props:e.props,isClone:!1,horizontal:e.horizontal,labelStyle:e.labelStyle,collapsable:e.collapsable,renderContent:e.renderContent,labelClassName:e.labelClassName},we({_:2},[e.defaultSlot?{name:"default",fn:j(({node:g})=>[le(e.$slots,"default",{node:g})])}:void 0,e.expandSlot?{name:"expand",fn:j(({node:g})=>[le(e.$slots,"expand",{node:g})])}:void 0]),1032,["data","props","horizontal","labelStyle","collapsable","renderContent","labelClassName"])],2),[[Ne,e.modelValue]])])},Re.__file="src/components/clone-org/clone-org.vue";const Et=(e,{emit:t},o)=>{const a=$("");function c(s,n,u){if(s[n]===u)return s;if(Array.isArray(s.children)){const h=s.children;for(let D=0,y=h.length;D<y;D++){const _=c(h[D],n,u);if(_)return _}}}function i(){const{props:s,data:n,node:u}=e;if(e.nodeDelete)return void e.nodeDelete(u.$$data);if(u.$$root)return void J.pretty("[\u63D0\u793A] ","\u6839\u8282\u70B9\u4E0D\u5141\u8BB8\u5220\u9664","danger");const{id:h,children:D}=s,y=c(n,h,u.pid);if(y){const _=y[D];for(let b=0,E=_.length;b<E;b++)if(_[b][h]===u.id){_.splice(b,1),t("onNodeDelete",u.$$data,u);break}}}function r(){const{nodeEdit:s,node:n}=e;s?s(n.$$data):(n.$$focused=!0,t("onNodeFocus",n.$$data))}function g(s){if(e.modelValue){if(o.eleRef.value&&o.eleRef.value.contains(s.target))return!1;t("update:modelValue",!1)}}const p=H(()=>({left:`${e.x}px`,top:`${e.y}px`})),v=H(()=>!e.disabled&&!e.node.disabled);return _e(()=>{document.addEventListener("mousedown",g)}),Ie(()=>{document.removeEventListener("mousedown",g)}),{position:p,editable:v,handleMenu:function(s){const n=s.target;if(n.className==="zm-tree-menu-item"){const u=n.getAttribute("action");switch(u){case"copy":(function(){if(e.nodeCopy)return void e.nodeCopy(e.node.$$data);a.value=e.node.label,be(()=>{o.inputRef&&o.inputRef.value&&(o.inputRef&&o.inputRef.value.select(),navigator.clipboard.writeText(a.value).then(function(){J.pretty("[\u63D0\u793A] ","\u6587\u672C\u590D\u5236\u6210\u529F","success")},function(){J.pretty("[\u9519\u8BEF] ","\u6D4F\u89C8\u5668\u4E0D\u652F\u6301","danger")}),t("onNodeCopy",a.value))})})();break;case"add":(function(){if(e.nodeAdd)return void e.nodeAdd(e.node.$$data);const{id:h,pid:D,label:y,expand:_,children:b}=e.props,{node:E}=e,N={[h]:String(new Date().getTime()),[D]:E.id,[y]:"",[_]:!1,[b]:[],newNode:!0,focused:!0};Array.isArray(E.children)?E.$$data[b].push(N):E.$$data[b]=[N],t("onNodeFocus",N)})();break;case"edit":r();break;case"delete":i()}t("contextmenu",{command:u,node:e.node,data:e.node.$$data}),t("update:modelValue",!1)}},handleEdit:r,handleClose:g,afterEnter:function(){t("opened")},afterLeave:function(){t("closed")}}};var Ae=se({name:"Contextmenu",props:Se({modelValue:{type:Boolean,required:!0},data:{type:Object,required:!0},node:{type:de(Object),required:!0},props:{type:de(Object)},x:Number,y:Number,menus:{type:de(Array)},nodeAdd:Function,nodeDelete:Function,nodeEdit:Function,nodeCopy:Function,disabled:Boolean}),emits:{onNodeDelete:(e,t)=>z(e)&&z(t),onNodeCopy:e=>Z(e),contextmenu:e=>z(e),onNodeFocus:e=>z(e),opened:()=>!0,closed:()=>!0,"update:modelValue":e=>typeof e=="boolean"},setup(e,t){const o=$(),a=$();return{eleRef:a,inputRef:o,copyText:$(""),oldData:fe({}),...Et(e,t,{inputRef:o,eleRef:a})}}});const zt=["action"];Ae.render=function(e,t,o,a,c,i){return L(),re(Ke,{to:"body"},[X(tt,{name:"dialog-fade",onAfterEnter:e.afterEnter,onAfterLeave:e.afterLeave,persisted:""},{default:j(()=>[ve(R("div",{style:Le(e.position),onClick:t[1]||(t[1]=(...r)=>e.handleMenu&&e.handleMenu(...r)),ref:"eleRef",class:"zm-tree-contextmenu"},[R("ul",null,[(L(!0),K(Xe,null,at(e.menus,r=>(L(),K(Xe,null,[e.editable||!["add","edit","delete"].includes(r.command)?(L(),K("li",{class:"zm-tree-menu-item",action:r.command,key:r.command},$e(r.name),9,zt)):ee("v-if",!0)],64))),256))]),ve(R("textarea",{class:"copy-textarea",ref:"inputRef","onUpdate:modelValue":t[0]||(t[0]=r=>e.copyText=r)},null,512),[[lt,e.copyText]])],4),[[Ne,e.modelValue]])]),_:1},8,["onAfterEnter","onAfterLeave"])])},Ae.__file="src/components/contextmenu/src/contextmenu.vue";const Mt=[{name:"\u590D\u5236\u6587\u672C",command:"copy"},{name:"\u65B0\u589E\u8282\u70B9",command:"add"},{name:"\u7F16\u8F91\u8282\u70B9",command:"edit"},{name:"\u5220\u9664\u8282\u70B9",command:"delete"}],wt=Se({data:{type:Object,required:!0},props:{type:de(Object),default:()=>({id:"id",pid:"pid",label:"label",expand:"expand",children:"children"})},toolBar:{type:[Object,Boolean],default:()=>({expand:!0,scale:!0,zoom:!0,restore:!0,fullscreen:!0})},disabled:{type:Boolean,default:!1},scalable:{type:Boolean,default:!0},draggable:{type:Boolean,default:!0},draggableOnNode:{type:Boolean,default:!1},nodeDraggable:{type:Boolean,default:!0},cloneNodeDrag:{type:Boolean,default:!0},onlyOneNode:{type:Boolean,default:!0},clickDelay:{type:Number,default:260},lazy:Boolean,load:{type:de(Function)},defaultExpandLevel:Number,defaultExpandKeys:{type:Array,default:()=>[]},beforeDragEnd:Function,horizontal:Boolean,selectedKey:{type:[Array,String,Number]},collapsable:Boolean,renderContent:Function,labelStyle:Object,labelClassName:{type:[Function,String]},selectedClassName:{type:[Function,String]},defineMenus:{type:de([Array,Function]),default:()=>Mt},nodeAdd:Function,nodeDelete:Function,nodeEdit:Function,nodeCopy:Function,filterNodeMethod:Function}),Ot=(e,{emit:t},o)=>{const a=$(0),c=$(0),i=$(!1);function r(d,l){const S=o.zoomRef.value,k=o.treeRef.value,O=S.clientWidth/2,B=S.clientHeight/2;let T=S.clientHeight-k.clientHeight,I=S.clientWidth-k.clientWidth;T>0&&(T=0),I>0&&(I=0),a.value=d>O?O:d<I?I:d,c.value=l<T?T:l>B?B:l}function g(d,l){r(d,l),setTimeout(()=>{pe.set(!1)},200),t("on-drag-stop",{x:d,y:l})}const p=$(!1),v=fe({value:{}}),s=$(!1),n=$(0),u=$(0),h=$({}),D=$([]),y=$(1);function _(d){if(!e.scalable)return;const l=Number((Number(y.value)+d).toFixed(1));y.value=d>0?Math.min(3,l):Math.max(.3,l)}function b(d,l,S){i.value=!0;const k=d.offsetLeft-l,O=d.offsetTop-S;a.value-=k,c.value-=O,r(a.value,c.value)}let E;const N=fe(Object.assign({id:"id",pid:"pid",label:"label",expand:"expand",children:"children",isLeaf:"isLeaf"},e.props)),C=$(!1);function f(d){d.forEach(l=>{l.expand&&(l.expand=!1,M.delete(l.id)),l.children&&f(l.children)})}const x=$(!1);function w(d,l){Array.isArray(d)?d.forEach(S=>{S.expand=l,l&&M.add(S.id),S.children&&w(S.children,l)}):(d.expand=l,l&&M.add(d.id),d.children&&w(d.children,l))}function G(d){q.value=V(d)}const Q=H(()=>({width:100/y.value+"%",height:100/y.value+"%",transform:`scale(${y.value})`})),W=H(()=>`${Math.round(100*y.value)}%`),Y=H(()=>e.draggableOnNode&&!e.nodeDraggable?"":`.tree-org-node__content:not(.is-root_${oe})>.tree-org-node__inner`),U=H(()=>x.value?"\u6536\u8D77\u5168\u90E8\u8282\u70B9":"\u5C55\u5F00\u5168\u90E8\u8282\u70B9"),De=H(()=>x.value?"\u6536\u8D77\u5168\u90E8\u8282\u70B9":"\u5C55\u5F00\u5168\u90E8\u8282\u70B9"),m=$({}),F=H(()=>{const{cloneNodeDrag:d,onlyOneNode:l,data:S}=e;return{drag:e.nodeDraggable,dragData:{keys:N,nodeMoving:p,stopClick:pe,parenNode:v,cloneNodeDrag:d,onlyOneNode:l,contextmenu:s,cloneData:m,data:S},beforeDragEnd:e.beforeDragEnd,initNodes:V,emit:t}});ae(()=>e.horizontal,()=>{be(()=>{g(a.value,c.value)})});let M=new Set(e.defaultExpandKeys);function V(d){const{defaultExpandLevel:l=0}=e,S=(k,O)=>{const{id:B,label:T,pid:I,expand:Ce,children:ge,isLeaf:ke}=N,xe={};Object.keys(k).map(he=>{["hidden","disabled","className","style"].includes(he)&&(xe[he]=k[he])});const Ve=k[ge],Ze=O+1,Pe=k[Ce],Ee=k[B];return(Pe||Pe===void 0&&O<l)&&M.add(Ee),{...xe,id:Ee,label:k[T],pid:k[I],expand:M.has(Ee),children:Ve?Ve.map(he=>S(he,Ze)):void 0,isLeaf:k[ke],$$level:O,$$data:k,$$focused:k.focused||!1}};return S(d,0)}const q=$(V(e.data));ae(()=>e.data,(d,l)=>{d!==l&&(M=new Set(e.defaultExpandKeys)),G(e.data)},{deep:!0});const A=fe({visible:!0,data:{expand:!0,scale:!0,zoom:!0,restore:!0,fullscreen:!0}});We(()=>{typeof e.toolBar=="object"?Object.assign(A.data,e.toolBar):e.toolBar||(A.visible=!1)});const oe=function(d){d=d||32;const l="ABCDEFGHJKMNPQRSTWXYZabcdefhijkmnprstwxyz2345678",S=l.length;let k="";for(let O=0;O<d;O++)k+=l.charAt(Math.floor(Math.random()*S));return k}(6);return{keys:N,left:a,top:c,menuX:n,menuY:u,suffix:oe,nodeMoving:p,zoomStyle:Q,tools:A,zoomPercent:W,dragCancel:Y,expandTitle:U,fullTiltle:De,nodeargs:F,expanded:x,fullscreen:C,treeData:q,autoDragging:i,contextmenu:s,nodeMenus:D,menuData:h,cloneData:m,filter:function(d){const l=e.filterNodeMethod;if(!l)throw new Error("[Tree] filterNodeMethod is required when filter");const S=function(k){const O=k.children||[];if(O.forEach(B=>{B.$$hidden=!l.call(B,d,B),S(B)}),k.$$hidden&&O.length){let B=!0;B=O.some(T=>!T.$$hidden),k.$$hidden=!B}d&&!k.$$hidden&&k.children&&(k.expand=!0)};S(q.value)},setData:G,zoomWheel:function(d){e.scalable&&(d.preventDefault(),d.deltaY<0?_(.1):_(-.1),t("on-zoom",y.value))},onDrag:function(d,l){pe.set(!0),i.value=!1,a.value=d,c.value=l,t("on-drag",{x:d,y:l})},onDragStop:g,expandChange:function(){x.value=!x.value,w(q.value,x.value),t("on-expand-all",x.value),x.value||(M.clear(),be(()=>{g(a.value,c.value)}))},handleFullscreen:function(d){C.value=!C.value,d!=="esc"&&(C.value?function(){const l=o.eleRef.value;l.requestFullscreen&&l.requestFullscreen()}():document.exitFullscreen&&document.exitFullscreen())},zoomOrgchart:_,restoreOrgchart:function(){y.value=1,a.value=0,c.value=0,t("on-restore")},handleExpand:function(d,l){d.stopPropagation();const S=document.querySelector(`.is-root_${oe}`);if(S){const k=S.offsetLeft,O=S.offsetTop;l.expand=!l.expand;let B=!0;l.expand?(M.add(l.id),e.lazy&&e.load&&(B=!1,function(T,I,Ce){I(T,(ge,ke)=>{const{children:xe}=N;T.isLeaf=!ge.length,ge.length&&(T.$$data[xe]=ge,ke&&Ce())})}(l,e.load,()=>{be(()=>{b(S,k,O)})}))):!l.expand&&l.children&&(M.delete(l.id),f(l.children)),be(()=>{B&&b(S,k,O)}),t("on-expand",d,l.$$data,l)}},getExpandKeys:function(){return[...M]},setExpandKeys:function(d){M=new Set(d),G(e.data)},nodeMouseenter:function(d,l){return p.value&&(v.value=l),t("on-node-mouseenter",d,l.$$data,l),!0},nodeMouseleave:function(d,l){return p.value&&(v.value=null),t("on-node-mouseleave",d,l.$$data,l),!0},nodeContextmenu:function(d,l){d.stopPropagation(),d.preventDefault();const{defineMenus:S}=e;Array.isArray(S)?D.value=S:typeof S=="function"&&(D.value=S(d,l)||[]),s.value=!0,n.value=d.clientX,u.value=d.clientY,h.value=l},handleBlur:function(d,l,S){const{id:k,label:O}=N,B=h.value.children||[];for(let T=B.length;T>0;T--){const I=B[T-1];if(I[k]===""&&I[O]===""){B.splice(T-1,1);break}}t("on-node-blur",d,l,S)},handleClick:function(d,l){pe.get()||(clearTimeout(E),E=setTimeout(()=>{t("on-node-click",d,l.$$data,l)},e.clickDelay))},handleDblclick:function(d,l){clearTimeout(E),t("on-node-dblclick",d,l.$$data,l)}}};var ie=se({name:"vue3TreeOrg",components:{Tools:Oe,CloneOrg:Re,Draggable:Be,Contextmenu:Ae,TreeOrgNode:je},directives:{nodedrag:He},props:wt,emits:{"on-drag":({x:e,y:t})=>te(e)&&te(t),"on-drag-stop":({x:e,y:t})=>te(e)&&te(t),"on-restore":()=>!0,"on-zoom":e=>te(e),"on-expand":(e,t,o)=>e instanceof MouseEvent&&z(o)&&z(t),"on-expand-all":e=>typeof e=="boolean","on-node-blur":(e,t,o)=>e instanceof FocusEvent&&z(o)&&z(t),"on-node-click":(e,t,o)=>e instanceof MouseEvent&&z(o)&&z(t),"on-node-dblclick":(e,t,o)=>e instanceof MouseEvent&&z(o)&&z(t),"on-node-mouseenter":(e,t,o)=>e instanceof MouseEvent&&z(o)&&z(t),"on-node-mouseleave":(e,t,o)=>e instanceof MouseEvent&&z(o)&&z(t),"on-contextmenu":e=>z(e),"on-node-copy":e=>Z(e),"on-node-delete":e=>z(e),"on-node-drag-start":e=>z(e),"on-node-drag":e=>z(e),"on-node-drag-end":(e,t)=>z(e)&&z(t),"on-node-focus":(e,t,o)=>e instanceof FocusEvent&&z(o)&&z(t)},setup(e,t){const o=!!t.slots.default,a=!!t.slots.expand,c=$(),i=$(),r=$();return{eleRef:c,treeRef:i,zoomRef:r,defaultSlot:o,expandSlot:a,...Ot(e,t,{eleRef:c,treeRef:i,zoomRef:r})}}});const Ft={ref:"eleRef",class:"zm-tree-org"},Bt={class:"tree-org-node__text"},Rt=R("span",{class:"tree-org-node__expand-btn"},null,-1),At={class:"tree-org-node__text"},Tt=R("span",{class:"tree-org-node__expand-btn"},null,-1);ie.render=function(e,t,o,a,c,i){const r=P("tree-org-node"),g=P("Draggable"),p=P("Tools"),v=P("clone-org"),s=P("Contextmenu");return L(),K("div",Ft,[R("div",{ref:"zoomRef",class:"zoom-container",style:Le(e.zoomStyle),onWheel:t[1]||(t[1]=(...n)=>e.zoomWheel&&e.zoomWheel(...n))},[X(g,{x:e.left,y:e.top,class:me({dragging:e.autoDragging}),onDragging:e.onDrag,onDragstop:e.onDragStop,draggable:e.draggable,"drag-cancel":e.dragCancel},{default:j(()=>[R("div",{ref:"treeRef",class:me(["tree-org",{horizontal:e.horizontal,collapsable:e.collapsable}])},[X(r,{data:e.treeData,props:e.keys,lazy:e.lazy,suffix:e.suffix,horizontal:e.horizontal,labelStyle:e.labelStyle,collapsable:e.collapsable,renderContent:e.renderContent,selectedKey:e.selectedKey,defaultExpandLevel:e.defaultExpandLevel,selectedClassName:e.selectedClassName,labelClassName:e.labelClassName,vNodedrag:e.nodeargs,onOnExpand:e.handleExpand,onNodeClick:e.handleClick,onNodeDblclick:e.handleDblclick,onNodeMouseenter:e.nodeMouseenter,onNodeMouseleave:e.nodeMouseleave,onNodeContextmenu:e.nodeContextmenu,onNodeFocus:t[0]||(t[0]=(n,u,h)=>{e.$emit("on-node-focus",n,u,h)}),onNodeBlur:e.handleBlur},we({_:2},[e.defaultSlot?{name:"default",fn:j(({node:n})=>[le(e.$slots,"default",{node:n},()=>[R("div",Bt,[R("span",null,$e(n.label),1)])])])}:void 0,e.expandSlot?{name:"expand",fn:j(({node:n})=>[le(e.$slots,"expand",{node:n},()=>[Rt])])}:void 0]),1032,["data","props","lazy","suffix","horizontal","labelStyle","collapsable","renderContent","selectedKey","defaultExpandLevel","selectedClassName","labelClassName","vNodedrag","onOnExpand","onNodeClick","onNodeDblclick","onNodeMouseenter","onNodeMouseleave","onNodeContextmenu","onNodeBlur"])],2)]),_:3},8,["x","y","class","onDragging","onDragstop","draggable","drag-cancel"])],36),e.tools.visible?(L(),re(p,{key:0,tools:e.tools.data,scale:e.zoomPercent,onOnExpand:e.expandChange,onOnScale:e.zoomOrgchart,onOnRestore:e.restoreOrgchart,onOnFullscreen:e.handleFullscreen},null,8,["tools","scale","onOnExpand","onOnScale","onOnRestore","onOnFullscreen"])):ee("v-if",!0),e.nodeDraggable?(L(),re(v,{key:1,modelValue:e.nodeMoving,"onUpdate:modelValue":t[2]||(t[2]=n=>e.nodeMoving=n),props:e.keys,data:e.cloneData,horizontal:e.horizontal,"label-style":e.labelStyle,collapsable:e.collapsable,"render-content":e.renderContent,"label-class-name":e.labelClassName},we({_:2},[e.defaultSlot?{name:"default",fn:j(({node:n})=>[le(e.$slots,"default",{node:n},()=>[R("div",At,[R("span",null,$e(n[e.keys.label]),1)])])])}:void 0,e.expandSlot?{name:"expand",fn:j(({node:n})=>[le(e.$slots,"expand",{node:n},()=>[Tt])])}:void 0]),1032,["modelValue","props","data","horizontal","label-style","collapsable","render-content","label-class-name"])):ee("v-if",!0),e.nodeMenus.length?(L(),re(s,{key:2,modelValue:e.contextmenu,"onUpdate:modelValue":t[3]||(t[3]=n=>e.contextmenu=n),x:e.menuX,y:e.menuY,node:e.menuData,data:e.data,props:e.keys,menus:e.nodeMenus,disabled:e.disabled,"node-add":e.nodeAdd,"node-delete":e.nodeDelete,"node-edit":e.nodeEdit,"node-copy":e.nodeCopy,onContextmenu:t[4]||(t[4]=n=>{e.$emit("on-contextmenu",n)}),onOnNodeCopy:t[5]||(t[5]=n=>{e.$emit("on-node-copy",n)}),onOnNodeDelete:t[6]||(t[6]=n=>{e.$emit("on-node-delete",n)})},null,8,["modelValue","x","y","node","data","props","menus","disabled","node-add","node-delete","node-edit","node-copy"])):ee("v-if",!0)],512)},ie.__file="src/components/tree-org/src/tree.vue",ie.install=function(e){e.component(ie.name,ie)};const Lt=Te("\u91CD\u7F6E"),jt={style:{height:"400px"}},Xt=se({__name:"index",setup(e){const t=$({}),o=async()=>{t.value=await st({})},a=()=>{o()};_e(()=>{o()});const c=$(!1);let i;const r=s=>{c.value=!0,i=s},g=s=>{if(i){console.log(s);const n={...s,id:dt(8),pid:i.id};i.children?i.children.push(n):i.children=[n]}},p=(s,n)=>{console.log(n)},v=(s,n)=>{console.log(n),n.id="1529986245"};return(s,n)=>{const u=P("el-button"),h=P("el-header"),D=P("el-container");return L(),re(D,{class:"page-container"},{default:j(()=>[X(h,null,{default:j(()=>[X(u,{type:"primary",onClick:a},{default:j(()=>[Lt]),_:1})]),_:1}),R("div",jt,[X(qe(ie),{collapsable:"",data:t.value,"node-add":r,"clone-node-drag":!1,onOnNodeBlur:v,onOnNodeClick:p},null,8,["data"])]),X(pt,{visible:c.value,"onUpdate:visible":n[0]||(n[0]=y=>c.value=y),onSubmit:g},null,8,["visible"])]),_:1})}}});export{Xt as default};
